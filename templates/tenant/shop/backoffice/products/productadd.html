{% extends "backoffice_base.html" %}
{% block content %}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <form method="post"
              action=""
              enctype="multipart/form-data"
              class="card bg-white shadow-lg rounded-xl p-8 space-y-10">
            {% csrf_token %}
            <!-- Header -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <h2 class="text-3xl font-semibold text-gray-800">Add / Edit Product</h2>
                <div class="flex gap-3">
                    <label for="brand_modal" class="btn btn-outline btn-sm btn-primary">
                        <i class="fas fa-plus mr-2"></i> Add Brand
                    </label>
                    <label for="category_modal" class="btn btn-outline btn-sm btn-primary">
                        <i class="fas fa-plus mr-2"></i> Add Category
                    </label>
                </div>
            </div>
            <!-- Product Info -->
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Product Name</span>
                        </label>
                        <input name="name"
                               type="text"
                               class="input input-bordered w-full"
                               placeholder="Enter product name" />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Category</span>
                        </label>
                        <div id="category_dropdown">
                            {% include "backoffice/components/category_dropdown.html" with categories=categories %}
                        </div>
                    </div>
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Description</span>
                    </label>
                    <textarea name="description"
                              class="textarea textarea-bordered h-32"
                              placeholder="Product description"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Brand</span>
                        </label>
                        <div id="brand-dropdown">{% include "backoffice/components/brand_dropdown.html" with brands=brands %}</div>
                    </div>
                    <div class="form-control mt-6">
                        <label class="cursor-pointer label gap-3">
                            <input type="checkbox" name="is_available" class="checkbox checkbox-primary" />
                            <span class="label-text font-semibold">Available</span>
                        </label>
                    </div>
                </div>
            </div>
            <!-- Pricing -->
            <div class="divider">Pricing</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Price</span>
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-500">$</span>
                        <input name="price"
                               type="number"
                               step="0.01"
                               class="input input-bordered w-full pl-8"
                               placeholder="0.00" />
                    </div>
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Compare At Price</span>
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-500">$</span>
                        <input name="compare_at_price"
                               type="number"
                               step="0.01"
                               class="input input-bordered w-full pl-8"
                               placeholder="0.00" />
                    </div>
                </div>
            </div>
            <!-- SEO -->
            <div class="divider">SEO</div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Meta Title</span>
                    </label>
                    <input name="meta_title"
                           type="text"
                           class="input input-bordered w-full"
                           placeholder="SEO title" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Meta Description</span>
                    </label>
                    <input name="meta_description"
                           type="text"
                           class="input input-bordered w-full"
                           placeholder="SEO description" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Keywords</span>
                    </label>
                    <input name="keywords"
                           type="text"
                           class="input input-bordered w-full"
                           placeholder="comma, separated, keywords" />
                </div>
            </div>
            <!-- Physical Attributes -->
            <div class="divider">Physical Attributes</div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Weight (g)</span>
                    </label>
                    <input name="weight"
                           type="number"
                           class="input input-bordered w-full"
                           placeholder="0" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Length (cm)</span>
                    </label>
                    <input name="length"
                           type="number"
                           class="input input-bordered w-full"
                           placeholder="0" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Width (cm)</span>
                    </label>
                    <input name="width"
                           type="number"
                           class="input input-bordered w-full"
                           placeholder="0" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Height (cm)</span>
                    </label>
                    <input name="height"
                           type="number"
                           class="input input-bordered w-full"
                           placeholder="0" />
                </div>
            </div>
            <!-- Images -->
            <div class="divider">Images</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Main Image</span>
                    </label>
                    <input name="main_image"
                           type="file"
                           class="file-input file-input-bordered w-full" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Additional Images</span>
                    </label>
                    <input name="images"
                           type="file"
                           multiple
                           class="file-input file-input-bordered w-full" />
                </div>
            </div>
            <!-- Submit -->
            <div class="pt-6">
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-save mr-2"></i> Save Product
                </button>
            </div>
        </form>
        <!-- Brand Modal -->
        <input type="checkbox" id="brand_modal" class="modal-toggle" />
        <div class="modal">
            <div class="modal-box relative">
                <label for="brand_modal"
                       class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
                <h3 class="font-bold text-lg mb-4">Add Brand</h3>
                <form hx-post="{% url 'backoffice:add-brand' %}"
                      enctype="multipart/form-data"
                      hx-target="#brand-dropdown"
                      hx-swap="innerHTML">
                    {% csrf_token %}
                    <div class="space-y-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Brand Name</span>
                            </label>
                            <input name="brand_name"
                                   type="text"
                                   class="input input-bordered w-full"
                                   placeholder="Enter brand name" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Description</span>
                            </label>
                            <textarea name="brand_description"
                                      class="textarea textarea-bordered h-24"
                                      placeholder="Brand description"></textarea>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Logo</span>
                            </label>
                            <input name="brand_logo"
                                   type="file"
                                   class="file-input file-input-bordered w-full" />
                        </div>
                    </div>
                    <div class="modal-action">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save mr-2"></i> Save
                        </button>
                        <label for="brand_modal" class="btn">Close</label>
                    </div>
                </form>
            </div>
        </div>
        <!-- Category Modal -->
        <input type="checkbox" id="category_modal" class="modal-toggle" />
        <div class="modal">
            <div class="modal-box relative">
                <label for="category_modal"
                       class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
                <h3 class="font-bold text-lg mb-4">Add Category</h3>
                <form hx-post="{% url 'backoffice:add-category' %}"
                      hx-swap="innerHTML"
                      hx-target="#category_dropdown"
                      hx-trigger="submit"
                      _="on htmx:afterRequest send new-category-added to #parent_category_id">
                    {% csrf_token %}
                    <div class="space-y-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Category Name</span>
                            </label>
                            <input name="category_name"
                                   type="text"
                                   class="input input-bordered w-full"
                                   placeholder="Enter category name" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Description</span>
                            </label>
                            <textarea name="category_description"
                                      class="textarea textarea-bordered h-24"
                                      placeholder="Category description"></textarea>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Parent Category</span>
                            </label>
                            <select hx-swap="outerHTML"
                                    hx-trigger="new-category-added"
                                    hx-get="{% url 'backoffice:add-category' %}"
                                    id="parent_category_id"
                                    name="parent_category_id"
                                    class="select select-bordered w-full">
                                <option value="">None</option>
                                {% for cat in categories %}<option value="{{ cat.id }}">{{ cat.name }}</option>{% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="modal-action">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save mr-2"></i> Save
                        </button>
                        <label for="category_modal" class="btn">Close</label>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock content %}
