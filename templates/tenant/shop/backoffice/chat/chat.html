{% extends "backoffice_base.html" %}
{% block content %}
    <div class="flex flex-col h-screen bg-base-200">
        <div id="main-chat"
             class="flex-1 overflow-y-auto p-4 space-y-4 bg-base-100 rounded-lg shadow-inner">
            {% include "backoffice/chat/chat_component.html" with message=message %}
        </div>
        <form class="mt-4 flex gap-2"
              hx-post="{% url 'backoffice:chat-with-database' %}"
              hx-swap="innerHTML"
              hx-target="#main-chat"
              hx-disabled-elt="find input[type='text'], find button"
              hx-indicator="#loading">
            <input type="text"
                   id="submit"
                   name="nl_query"
                   placeholder="Type your message..."
                   class="input input-bordered flex-1 rounded-lg" />
                   
            <button id="submit"  type="submit" class="btn btn-primary">
                <span id="loading"
                      class="loading loading-spinner loading-xs htmx-indicator"></span>
                Send
            </button>
        </form>
    </div>
{% endblock content %}
{% block script %}
    <script>
document.addEventListener("htmx:afterSwap", function(event) {
    // Only scroll if the target was the chat container
    if (event.target.id === "main-chat") {
        const chatContainer = document.getElementById("main-chat");
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }
});

window.addEventListener("load", function() {
    const chatContainer = document.getElementById("main-chat");
    chatContainer.scrollTop = chatContainer.scrollHeight;
});

    </script>
{% endblock script %}
